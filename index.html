<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>ALHADI Global Network</title>
    
    <!-- Frameworks -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/hls.js/1.4.12/hls.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&family=Noto+Sans+Arabic:wght@300;400;600;700;800&display=swap');
        
        :root {
            --alhadi-gold: #fbbf24;
            --alhadi-primary: #0f172a;
        }

        body { 
            font-family: 'Plus Jakarta Sans', 'Noto Sans Arabic', sans-serif; 
            background-color: var(--alhadi-primary); 
            color: white; 
            margin: 0;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            overflow-x: hidden;
        }

        body.rtl { direction: rtl; }

        /* --- SPLASH SCREEN --- */
        #splash-screen {
            background-image: linear-gradient(to bottom, rgba(15, 23, 42, 0.5), rgba(15, 23, 42, 0.9)), url('https://i.ibb.co/39s9PYJr/Main-P1.jpg');
            background-size: cover;
            background-position: center;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;
            padding: 4rem 2rem;
        }

        .logo-container {
            width: clamp(140px, 40vw, 200px);
            height: clamp(140px, 40vw, 200px);
            filter: drop-shadow(0 0 30px rgba(251, 191, 36, 0.4));
        }

        .brand-text {
            font-size: clamp(3rem, 15vw, 4.5rem);
            font-weight: 800;
            letter-spacing: -0.04em;
            line-height: 1;
            text-align: center;
        }

        .gold-glow {
            color: var(--alhadi-gold);
            text-shadow: 0 0 40px rgba(251, 191, 36, 0.6);
        }

        .btn-premium {
            background: linear-gradient(135deg, #fbbf24 0%, #d97706 100%);
            padding: 20px 0;
            border-radius: 24px;
            font-weight: 800;
            color: #000;
            box-shadow: 0 15px 35px rgba(217, 119, 6, 0.4);
            text-transform: uppercase;
        }

        /* --- DASHBOARD --- */
        #main-content {
            background-image: linear-gradient(to bottom, rgba(15, 23, 42, 0.9), rgba(15, 23, 42, 0.98)), url('Channel_list_p2.jpg');
            background-size: cover;
            background-attachment: fixed;
        }

        .hero-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.05) 0%, rgba(255,255,255,0.01) 100%);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 32px;
            backdrop-filter: blur(20px);
        }

        .detail-tag {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 6px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            color: rgba(255, 255, 255, 0.7);
        }

        .social-pill {
            width: 44px;
            height: 44px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(251, 191, 36, 0.1);
            border: 1px solid rgba(251, 191, 36, 0.2);
            color: var(--alhadi-gold);
            transition: all 0.2s ease;
        }
        .social-pill svg {
            width: 20px;
            height: 20px;
            fill: currentColor;
        }
        .social-pill:active {
            background: var(--alhadi-gold);
            color: black;
            transform: scale(0.9);
        }

        /* Chat interface */
        #chat-container {
            height: 400px;
            display: flex;
            flex-direction: column;
        }
        #chat-messages {
            flex-grow: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .msg {
            margin-bottom: 1rem;
            max-width: 85%;
            padding: 0.75rem 1rem;
            border-radius: 18px;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .msg-user {
            align-self: flex-end;
            background: var(--alhadi-gold);
            color: black;
            border-bottom-right-radius: 4px;
            margin-left: auto;
        }
        .msg-ai {
            align-self: flex-start;
            background: rgba(255,255,255,0.1);
            color: white;
            border-bottom-left-radius: 4px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        /* Bottom Nav */
        .bottom-nav {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(24px);
            border-top: 1px solid rgba(255,255,255,0.1);
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 80px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            z-index: 100;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: rgba(255,255,255,0.4);
            font-size: 0.65rem;
            font-weight: 700;
            gap: 4px;
            flex: 1;
        }

        .nav-item.active { color: var(--alhadi-gold); }

        .hide { display: none !important; }

        .namaz-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .city-btn {
            padding: 8px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            transition: all 0.2s;
        }
        .city-btn.active {
            background: var(--alhadi-gold);
            color: black;
            border-color: var(--alhadi-gold);
        }
    </style>
</head>
<body>

    <!-- Splash Screen -->
    <div id="splash-screen" class="fixed inset-0">
        <div class="flex flex-col items-center">
            <div class="logo-container mb-6">
                <img src="https://i.ibb.co/sJvqjQg0/alhadi-logo.png" alt="ALHADI Logo" class="w-full h-full object-contain">
            </div>
            <div class="brand-text">
                <span data-i18n="brand_name">ALHADI</span><br>
                <span class="gold-glow" data-i18n="network_name">GLOBAL</span>
            </div>
        </div>

        <div class="flex gap-2 p-1 bg-white/5 rounded-2xl border border-white/10">
            <button id="lang-en" onclick="setLanguage('en')" class="px-6 py-2 rounded-xl text-sm font-bold active">EN</button>
            <button id="lang-fa" onclick="setLanguage('fa')" class="px-6 py-2 rounded-xl text-sm font-bold">FA</button>
        </div>

        <button onclick="enterApp()" class="btn-premium w-full max-w-xs text-lg" data-i18n="enter_btn">ENTER NETWORK</button>
    </div>

    <!-- Main Content Area -->
    <div id="main-content" class="hide min-h-screen pb-24">
        <!-- Home Section -->
        <div id="home-section" class="p-6">
            <div class="flex items-center justify-between mb-8 pt-4">
                <div class="font-black text-xl">
                    <span data-i18n="brand_name">ALHADI</span> 
                    <span class="text-amber-400" data-i18n="network_name">GLOBAL</span>
                </div>
                <button onclick="goBackToSplash()" class="text-white/40"><i class="fas fa-sign-out-alt"></i></button>
            </div>

            <div class="hero-card overflow-hidden shadow-2xl mb-8" onclick="openPlayer()">
                <div class="relative">
                    <img src="https://i.ibb.co/9HGg9WM8/alhadi-thumb.png" class="w-full h-64 object-cover" alt="Live">
                    <div class="absolute inset-0 bg-black/40 flex items-center justify-center">
                        <div class="w-16 h-16 rounded-full bg-amber-400 flex items-center justify-center">
                            <i class="fas fa-play text-black text-xl ml-1"></i>
                        </div>
                    </div>
                    <div class="absolute top-4 left-4 bg-red-600 px-3 py-1 rounded-full text-[10px] font-black uppercase tracking-widest">Live</div>
                </div>
                <div class="p-6">
                    <h3 class="font-bold text-lg" data-i18n="main_channel">Main Channel</h3>
                    <p class="text-sm text-white/50" data-i18n="stream_desc">24/7 International Broadcast</p>
                </div>
            </div>

            <!-- Social Buttons -->
            <div class="flex justify-between items-center mb-8 px-2">
                <a href="https://wa.me/9647747888572" target="_blank" class="social-pill"><i class="fab fa-whatsapp"></i></a>
                <a href="https://www.youtube.com/@alhadi_fd" target="_blank" class="social-pill"><i class="fab fa-youtube"></i></a>
                <a href="https://www.facebook.com/profile.php?id=61563577508647" target="_blank" class="social-pill"><i class="fab fa-facebook"></i></a>
                <a href="https://www.instagram.com/alhadi_fd" target="_blank" class="social-pill"><i class="fab fa-instagram"></i></a>
                <a href="https://www.aparat.com/alhadichannel" target="_blank" class="social-pill" title="Aparat">
                    <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12 0C5.373 0 0 5.373 0 12s5.373 12 12 12 12-5.373 12-12S18.627 0 12 0zm0 18.462c-3.564 0-6.462-2.898-6.462-6.462S8.436 5.538 12 5.538s6.462 2.898 6.462 6.462-2.898 6.462-6.462 6.462zM12 7.385a4.615 4.615 0 1 0 0 9.23 4.615 4.615 0 0 0 0-9.23zm2.538 4.615a2.538 2.538 0 1 1-5.076 0 2.538 2.538 0 0 1 5.076 0z"/>
                    </svg>
                </a>
            </div>

            <div class="hero-card p-6">
                <div class="text-[10px] font-bold text-white/30 uppercase tracking-widest mb-4" data-i18n="channel_info">Channel Info</div>
                <div class="grid grid-cols-2 gap-3">
                    <div class="detail-tag">
                        <span class="opacity-50 block mb-1" data-i18n="label_lang">Language</span>
                        <span class="text-white" data-i18n="val_lang">English / Farsi</span>
                    </div>
                    <div class="detail-tag">
                        <span class="opacity-50 block mb-1" data-i18n="label_genre">Genre</span>
                        <span class="text-white" data-i18n="val_genre">Religious</span>
                    </div>
                    <div class="detail-tag">
                        <span class="opacity-50 block mb-1" data-i18n="label_quality">Quality</span>
                        <span class="text-white">Full HD 1080p</span>
                    </div>
                    <div class="detail-tag">
                        <span class="opacity-50 block mb-1" data-i18n="label_region">Region</span>
                        <span class="text-white" data-i18n="val_region">Global</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Namaz Section -->
        <div id="namaz-section" class="hide p-6">
            <h2 class="text-2xl font-black mb-6 pt-4" data-i18n="nav_namaz">Namaz Timing</h2>
            
            <!-- City Selection -->
            <div class="flex flex-wrap gap-2 mb-6">
                <button class="city-btn active" data-city="Mashhad" onclick="changeCity('Mashhad')">Mashhad</button>
                <button class="city-btn" data-city="Kabul" onclick="changeCity('Kabul')">Kabul</button>
                <button class="city-btn" data-city="Mazar" onclick="changeCity('Mazar')">Mazar</button>
                <button class="city-btn" data-city="Herat" onclick="changeCity('Herat')">Herat</button>
                <button class="city-btn" data-city="Najaf" onclick="changeCity('Najaf')">Najaf</button>
            </div>

            <div class="hero-card p-6 text-center mb-6">
                <div class="text-amber-400 font-bold" id="current-city-display">Mashhad</div>
                <div id="namaz-date" class="text-sm opacity-60 mt-1">Today</div>
            </div>
            <div id="namaz-list" class="space-y-1"></div>
        </div>

        <!-- Questions Section (AI Chatbot) -->
        <div id="questions-section" class="hide p-6">
            <h2 class="text-2xl font-black mb-4 pt-4" data-i18n="nav_questions">AI Fatwa Assistant</h2>
            <div class="hero-card p-0 overflow-hidden flex flex-col" style="height: calc(100vh - 280px);">
                <div class="bg-white/5 p-3 text-[10px] uppercase font-bold text-center border-bottom border-white/10 opacity-60">
                    Sistani Fatwa Guide
                </div>
                
                <!-- Chat View -->
                <div id="chat-messages" class="flex flex-col">
                    <div class="msg msg-ai" data-i18n="bot_welcome">Salaam. I can answer your religious questions based exclusively on the rulings of Ayatollah Sistani. How can I help you?</div>
                </div>

                <!-- Input Area -->
                <div class="p-4 bg-black/20 border-t border-white/10">
                    <div class="flex gap-2">
                        <input type="text" id="chat-input" placeholder="Ask a question..." class="flex-grow bg-white/5 border border-white/10 rounded-xl px-4 py-3 text-sm focus:outline-none focus:border-amber-400">
                        <button onclick="sendMessage()" id="send-btn" class="bg-amber-400 text-black w-12 h-12 rounded-xl flex items-center justify-center">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- About Section -->
        <div id="about-section" class="hide p-6">
            <h2 class="text-2xl font-black mb-8 pt-4" data-i18n="nav_about">About Us</h2>
            <div class="hero-card p-8 space-y-6 text-center">
                <img src="https://i.ibb.co/sJvqjQg0/alhadi-logo.png" class="h-20 mx-auto" alt="Logo">
                <p class="text-sm text-white/70 leading-relaxed" data-i18n="about_content">
                    Alhadi Global TV is a worldwide media network dedicated to providing high-quality Islamic programming globally.
                </p>
                <div class="pt-4 space-y-2">
                    <div class="text-xs text-white/30 font-bold uppercase" data-i18n="contact_us">Contact Us</div>
                    <div class="text-amber-400 font-bold text-sm">info@alhaditv.com</div>
                </div>
            </div>
        </div>

        <!-- Navigation Bar -->
        <nav class="bottom-nav">
            <button onclick="switchTab('home')" id="tab-home" class="nav-item active">
                <i class="fas fa-play-circle text-xl"></i>
                <span data-i18n="tab_home">Home</span>
            </button>
            <button onclick="switchTab('namaz')" id="tab-namaz" class="nav-item">
                <i class="fas fa-clock text-xl"></i>
                <span data-i18n="nav_namaz">Namaz</span>
            </button>
            <button onclick="switchTab('questions')" id="tab-questions" class="nav-item">
                <i class="fas fa-comment-dots text-xl"></i>
                <span data-i18n="nav_questions">Questions</span>
            </button>
            <button onclick="switchTab('about')" id="tab-about" class="nav-item">
                <i class="fas fa-info-circle text-xl"></i>
                <span data-i18n="nav_about">About</span>
            </button>
        </nav>
    </div>

    <!-- Player Overlay -->
    <div id="player-view" class="hide fixed inset-0 z-[200] bg-black">
        <div class="p-6 flex items-center justify-between"><button onclick="closePlayer()"><i class="fas fa-times text-2xl"></i></button></div>
        <video id="video-stream" class="w-full h-auto aspect-video" controls autoplay playsinline></video>
    </div>

    <script>
        const apiKey = "";
        
        const cities = {
            Mashhad: { lat: 36.2972, lng: 59.6067, tz: 3.5 },
            Kabul: { lat: 34.5553, lng: 69.1771, tz: 4.5 },
            Mazar: { lat: 36.7069, lng: 67.1103, tz: 4.5 },
            Herat: { lat: 34.3529, lng: 62.2040, tz: 4.5 },
            Najaf: { lat: 32.0160, lng: 44.3310, tz: 3.0 }
        };

        let activeCity = "Mashhad";

        const PrayTimes = function() {
            this.getTimes = function(date, lat, lng, tz) {
                // Mock implementation of time calculation logic
                const dayOfYear = date.getDate() + (date.getMonth() * 30);
                const offset = (dayOfYear % 5) * 0.1;
                const base = [5, 6, 12, 16, 18, 19, 20];
                const prayers = ['fajr', 'sunrise', 'dhuhr', 'asr', 'sunset', 'maghrib', 'isha'];
                let times = {};
                prayers.forEach((p, i) => {
                    let h = base[i];
                    let m = Math.floor((lng + lat + dayOfYear) % 60);
                    times[p] = (h < 10 ? '0' : '') + h + ':' + (m < 10 ? '0' : '') + m;
                });
                return times;
            };
        };
        const prayTimes = new PrayTimes();

        const translations = {
            en: {
                brand_name: "ALHADI", network_name: "GLOBAL", enter_btn: "ENTER NETWORK",
                nav_namaz: "Namaz Timing", nav_about: "About Us", tab_home: "Home",
                nav_questions: "Questions",
                main_channel: "Main Channel", stream_desc: "24/7 International Broadcast",
                channel_info: "Channel Info", label_lang: "Language", val_lang: "English / Farsi",
                label_genre: "Genre", val_genre: "Religious", label_quality: "Quality", 
                label_region: "Region", val_region: "Global",
                namaz_city: "Mashhad, Iran", today_btn: "Today", contact_us: "Contact Us",
                fajr: "Fajr", sunrise: "Sunrise", dhuhr: "Dhuhr", asr: "Asr", sunset: "Sunset", maghrib: "Maghrib", isha: "Isha",
                about_content: "Alhadi Global TV is a worldwide media network dedicated to providing high-quality Islamic programming globally.",
                bot_welcome: "Salaam. I can answer your religious questions based exclusively on the rulings of Ayatollah Sistani. How can I help you?"
            },
            fa: {
                brand_name: "الهادی", network_name: "جهانی", enter_btn: "ورود به شبکه",
                nav_namaz: "اوقات شرعی", nav_about: "درباره ما", tab_home: "خانه",
                nav_questions: "سوالات",
                main_channel: "شبکه اصلی", stream_desc: "پخش زنده ۲۴ ساعته",
                channel_info: "مشخصات شبکه", label_lang: "زبان", val_lang: "انگلیسی / فارسی",
                label_genre: "ژانر", val_genre: "مذهبی", label_quality: "کیفیت",
                label_region: "منطقه", val_region: "جهانی",
                namaz_city: "مشهد، ایران", today_btn: "امروز", contact_us: "ارتباط با ما",
                fajr: "اذان صبح", sunrise: "طلوع آفتاب", dhuhr: "اذان ظهر", asr: "اذان عصر", sunset: "غروب آفتاب", maghrib: "اذان مغرب", isha: "اذان عشا",
                about_content: "تلویزیون جهانی الهادی یک شبکه رسانه ای جهانی است که به ارائه برنامه های با کیفیت اسلامی اختصاص دارد.",
                bot_welcome: "سلام. من می‌توانم به سوالات شرعی شما منحصراً بر اساس فتاوای آیت‌الله سیستانی پاسخ دهم. چگونه می‌توانم به شما کمک کنم؟"
            }
        };

        let currentLang = 'en';

        function setLanguage(lang) {
            currentLang = lang;
            document.body.classList.toggle('rtl', lang === 'fa');
            document.getElementById('lang-en').classList.toggle('active', lang === 'en');
            document.getElementById('lang-fa').classList.toggle('active', lang === 'fa');
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) el.textContent = translations[lang][key];
            });
            updateNamaz();
        }

        function switchTab(tab) {
            ['home', 'namaz', 'about', 'questions'].forEach(t => {
                const el = document.getElementById(t + '-section');
                if(el) el.classList.add('hide');
                const btn = document.getElementById('tab-' + t);
                if(btn) btn.classList.remove('active');
            });
            document.getElementById(tab + '-section').classList.remove('hide');
            document.getElementById('tab-' + tab).classList.add('active');
        }

        function enterApp() {
            document.getElementById('splash-screen').classList.add('hide');
            document.getElementById('main-content').classList.remove('hide');
        }

        function goBackToSplash() {
            document.getElementById('main-content').classList.add('hide');
            document.getElementById('splash-screen').classList.remove('hide');
        }

        function openPlayer() {
            document.getElementById('player-view').classList.remove('hide');
            const video = document.getElementById('video-stream');
            const streamUrl = "https://zeuscdn724.com/lb0/alhadi/index.m3u8";
            if (Hls.isSupported()) {
                const hls = new Hls(); hls.loadSource(streamUrl); hls.attachMedia(video);
            } else { video.src = streamUrl; }
            video.play();
        }

        function closePlayer() { document.getElementById('video-stream').pause(); document.getElementById('player-view').classList.add('hide'); }

        function changeCity(cityName) {
            activeCity = cityName;
            document.querySelectorAll('.city-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector(`[data-city="${cityName}"]`).classList.add('active');
            document.getElementById('current-city-display').textContent = cityName;
            updateNamaz();
        }

        function updateNamaz() {
            const date = new Date();
            document.getElementById('namaz-date').textContent = date.toLocaleDateString(currentLang === 'fa' ? 'fa-IR' : 'en-US', { weekday: 'long', month: 'long', day: 'numeric' });
            
            const cityData = cities[activeCity];
            const times = prayTimes.getTimes(date, cityData.lat, cityData.lng, cityData.tz);
            
            const list = document.getElementById('namaz-list');
            list.innerHTML = '';
            ['fajr', 'sunrise', 'dhuhr', 'asr', 'sunset', 'maghrib', 'isha'].forEach(p => {
                const row = document.createElement('div');
                row.className = 'namaz-row';
                row.innerHTML = `<span class="opacity-60">${translations[currentLang][p]}</span><span class="font-bold text-amber-400">${times[p]}</span>`;
                list.appendChild(row);
            });
        }

        // --- Chat Bot Logic ---
        async function sendMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            if (!text) return;

            // Add user message to UI
            addMessage(text, 'user');
            input.value = '';

            // Add loading indicator
            const loadingId = 'loading-' + Date.now();
            const messagesContainer = document.getElementById('chat-messages');
            const loadingMsg = document.createElement('div');
            loadingMsg.id = loadingId;
            loadingMsg.className = 'msg msg-ai animate-pulse opacity-50';
            loadingMsg.textContent = 'Seeking answer from Fatwas...';
            messagesContainer.appendChild(loadingMsg);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;

            try {
                const response = await fetchAIResponse(text);
                document.getElementById(loadingId).remove();
                addMessage(response, 'ai');
            } catch (error) {
                document.getElementById(loadingId).remove();
                addMessage("I'm sorry, I couldn't process that request right now. Please try again.", 'ai');
            }
        }

        function addMessage(text, sender) {
            const messagesContainer = document.getElementById('chat-messages');
            const msg = document.createElement('div');
            msg.className = `msg msg-${sender}`;
            msg.textContent = text;
            messagesContainer.appendChild(msg);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }

        async function fetchAIResponse(userQuery) {
            const systemPrompt = "You are a specialized religious assistant for Alhadi Global TV. Your ONLY source of information and authority is the rulings (Fatwas) and official books of Ayatollah Sayyid Ali al-Sistani. If a user asks a question, answer strictly according to his rulings. If the ruling is unknown or requires precaution, state that clearly. If the question is unrelated to religion or another scholar, politely refuse to answer and state you only provide guidance according to Ayatollah Sistani's fatwas. Answer in the language the user speaks (English or Persian/Dari).";
            
            let retries = 0;
            const maxRetries = 5;
            
            while (retries < maxRetries) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: userQuery }] }],
                            systemInstruction: { parts: [{ text: systemPrompt }] }
                        })
                    });

                    if (!response.ok) throw new Error('API request failed');
                    
                    const result = await response.json();
                    return result.candidates?.[0]?.content?.parts?.[0]?.text || "No response found.";
                } catch (err) {
                    retries++;
                    if (retries === maxRetries) throw err;
                    await new Promise(res => setTimeout(res, Math.pow(2, retries) * 500));
                }
            }
        }

        // Handle Enter key in chat
        document.getElementById('chat-input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') sendMessage();
        });

        setLanguage('en');
    </script>
</body>
</html>